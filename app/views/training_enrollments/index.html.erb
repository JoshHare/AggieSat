<div class="container">
  <h2 class="mb-4">Training Enrollments </h2>

  <%= link_to("Add New Enrollment", new_training_enrollment_path, class: 'btn btn-primary mb-3') %>

  <%= form_tag({ controller: 'training_enrollments', action: 'email_all' }, method: 'post') do %>
    <%= button_tag('Email all', class: 'btn btn-info mb-3', type: 'submit') %>
  <% end %>

  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>User</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
       <% User.all.each do |user| %>
          <% overall_status = "Valid" %>
          <% TrainingCourse.all.each do |course| %>
            <% enrollment_result = TrainingService.check_enrollment_and_validity(course, user) %>
            <% if enrollment_result != "Valid" && enrollment_result != "Expiring Soon!" %>
              <% overall_status = "Invalid" %>
              <% break %>
            <% end %>
          <% end %>
  <tr>
    <td>  <%= user.id%>
      <%= link_to user.full_name, user_enrollments_training_enrollments_path(user_id: user.uid), class: overall_status == "Valid" ? "text-success" : "text-danger" %>
    </td>
    <td><%= overall_status %></td>
  </tr>
<% end %>
      </tbody>
    </table>
  </div>
</div>
